angular.module("angularDialogApp").service("dialogService",["$q","$http","$templateCache","$document","$timeout",function(t,n,r,i,s){function c(e,t){for(var n=0,r=a.length;n<r;n++){if(a[n][e]==t){return a[n]}}return null}function h(){var e=this;s(function(){e.callStackArray("destroy");a.splice(a.indexOf(e),1)})}var o=0;var u="../templates/mp_gen_notif.html";var a=[];var f=[];var l=function(e,n,r,i){if(!e)return;o++;var s=this;this.id=o;this.name=e;this.template=null;this.className=n;this.controller=null;this._persistent=i||false;this._ready=false;this._linkDefer=t.defer();this._originalTemplate="../templates/"+e+".html";if(angular.isObject(r)){function u(e){for(var t in r){e[t]=r[t]}u.$inject=["$scope"];this.$scope=e}this.controller=u}else if(angular.isFunction(r)){this.controller=r}this._callStack={dismiss:[],destroy:[],ready:[],open:[]};a.push(this);this.loadTemplate().then(function(t){s.template=t;s._linkDefer.promise.then(function(){s._ready=true;s.callStackArray("ready")})},function(){debug.error("Dialog template not specified")})};l.prototype.loadTemplate=function(){this.deferLoad=t.defer();if(this._ready){this.deferLoad.resolve(this.template)}else if(this._originalTemplate){var e=this;n.get(this._originalTemplate,{cache:r}).success(function(){e.deferLoad.resolve(e._originalTemplate)}).error(function(){e.deferLoad.resolve(u)})}else{this.deferLoad.reject()}return this.deferLoad.promise};l.prototype.open=function(e){e&&e.preventDefault();var n=t.defer(),r=this;var i=function(){r.showModal();f.unshift(r.id);n.resolve();r.callStackArray("open")};if(!this._ready||f.indexOf(this.id)!==-1){this.on("ready",i)}else{i()}return n.promise};l.prototype.dismiss=function(e){e&&e.preventDefault();var n=t.defer(),r=f.indexOf(this.id);if(!this._ready||r===-1){n.reject()}else{this.hideModal();f.splice(r,1);this.callStackArray("dismiss");n.resolve()}return n.promise};l.prototype.destroy=function(){var e=this;this.dismiss().then(function(){h.call(e)},function(){h.call(e)})};l.prototype.on=function(e,t){if(!t||!e||!angular.isFunction(t))return;if(e in this._callStack){this._callStack[e].push(t)}};l.prototype.callStackArray=function(e){var t=this._callStack[e]||[];for(var n=0,r=t.length;n<r;n++){t[n].call(this)}};l.prototype.close=function(){this._persistent?this.dismiss():this.destroy()};this.create=function(e,t,n,r){return new l(e,t,n,r)};this.get=function(e){return c("name",e)};this.getByClass=function(e){return c("className",e)};this.getById=function(e){return c("id",e)};this.allDialogs=function(){return a};this.openedDialogs=function(){return f};return this}]).directive("dcomDialogWidget",["dialogService","$document",function(e,t){return{priority:10,replace:true,templateUrl:"../src/spine.html",link:function(n,r,i){n.allDialogs=e.allDialogs;n.openedDialogs=e.openedDialogs;t.keyup(function(t){var r=e.openedDialogs()[0];n.$apply(function(){t.keyCode==27&&r&&e.getById(r).dismiss(t)&&t.preventDefault()})})}}}]).directive("dcomDialog",["dialogService",function(e){return{priority:200,link:function(t,n,r){var i={show:true,backdrop:false,keyboard:false};var s=e.getById(t.dialog.id);s.showModal=function(){n.modal(i)};s.hideModal=function(){n.modal("hide")};s._linkDefer.resolve()}}}]).directive("dcomDialogBackdrop",["dialogService",function(e){return{priority:100,replace:true,template:'<div class="dcomDialogBackdrop" ng-class="{shown: showBackdrop()}"></div>',link:function(t,n,r){t.showBackdrop=function(){return t.openedDialogs().length};n.on("click",function(n){t.$apply(function(){e.getById(t.openedDialogs()[0]).close(n)})})}}}])